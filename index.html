<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FoodieExpress - Premium Delivery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #FDFBF7;
            --bg-secondary: #FFFFFF;
            --bg-tertiary: #F5F1EB;
            --text-primary: #1A1A1A;
            --text-secondary: #6B6B6B;
            --accent: #E85A2C;
            --accent-hover: #D14A1E;
            --accent-light: #FFF0EA;
            --border: #E8E4DD;
            --success: #22C55E;
            --card-shadow: 0 10px 40px rgba(0,0,0,0.06);
            --glass-bg: rgba(255, 255, 255, 0.7);
        }

        [data-theme="dark"] {
            --bg-primary: #121212;
            --bg-secondary: #1E1E1E;
            --bg-tertiary: #2A2A2A;
            --text-primary: #FFFFFF;
            --text-secondary: #B0B0B0;
            --accent: #FF6B35;
            --accent-hover: #FF8155;
            --accent-light: #331F16;
            --border: #333333;
            --card-shadow: 0 10px 40px rgba(0,0,0,0.3);
            --glass-bg: rgba(30, 30, 30, 0.8);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        html { scroll-behavior: smooth; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            line-height: 1.6;
        }

        .font-display { font-family: 'Playfair Display', serif; }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-tertiary); }
        ::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 10px; }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .animate-fade-up { animation: fadeUp 0.6s ease-out forwards; }
        .animate-scale-in { animation: scaleIn 0.4s ease-out forwards; }
        .animate-float { animation: float 3s ease-in-out infinite; }

        .nav-glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
        }

        .card-premium {
            background: var(--bg-secondary);
            border-radius: 24px;
            border: 1px solid var(--border);
            box-shadow: var(--card-shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            overflow: hidden;
        }

        .card-premium:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 50px rgba(232, 90, 44, 0.15);
        }

        .btn-primary {
            background: var(--accent);
            color: white;
            padding: 14px 32px;
            border-radius: 100px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(232, 90, 44, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-primary);
            padding: 14px 32px;
            border-radius: 100px;
            font-weight: 600;
            border: 2px solid var(--border);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .input-premium {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 14px 20px;
            border-radius: 12px;
            width: 100%;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .input-premium:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px var(--accent-light);
        }

        .hero-gradient {
            background: radial-gradient(circle at 20% 50%, rgba(232, 90, 44, 0.08) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(232, 90, 44, 0.05) 0%, transparent 40%);
        }

        .theme-toggle {
            width: 50px;
            height: 26px;
            background: var(--bg-tertiary);
            border-radius: 50px;
            position: relative;
            cursor: pointer;
            border: 1px solid var(--border);
        }

        .theme-toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: var(--accent);
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        [data-theme="dark"] .theme-toggle::after {
            transform: translateX(24px);
            background: #FFD700;
        }

        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-backdrop.active { opacity: 1; visibility: visible; }

        .modal-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: var(--bg-secondary);
            border-radius: 24px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            z-index: 101;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-backdrop.active + .modal-content,
        .modal-content.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        .cart-drawer {
            position: fixed;
            top: 0;
            right: 0;
            width: 420px;
            max-width: 100%;
            height: 100vh;
            background: var(--bg-secondary);
            z-index: 102;
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: -10px 0 40px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }

        .cart-drawer.open { transform: translateX(0); }

        .search-container { position: relative; }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            margin-top: 8px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 50;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            display: none;
        }

        .search-results.active { display: block; }

        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--accent);
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            font-size: 12px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .text-gradient {
            background: linear-gradient(135deg, var(--accent) 0%, #FF8155 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .food-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        .card-premium:hover .food-img { transform: scale(1.05); }
        .img-container { overflow: hidden; }
        
        .filter-btn {
            padding: 10px 24px;
            border-radius: 100px;
            font-weight: 600;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }
        .filter-btn:hover { border-color: var(--accent); color: var(--accent); }
        .filter-btn.active { background: var(--accent); border-color: var(--accent); color: white; }
        
        .step-indicator {
            width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; background: var(--border); color: var(--text-secondary); transition: all 0.3s;
        }
        .step-indicator.active { background: var(--accent); color: white; }
        .step-indicator.done { background: var(--success); color: white; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav-glass fixed top-0 left-0 right-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <a href="#" class="flex items-center gap-3 group">
                    <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-orange-500 to-red-600 flex items-center justify-center shadow-lg group-hover:scale-105 transition-transform">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                        </svg>
                    </div>
                    <span class="font-display font-bold text-xl hidden sm:block">FoodieExpress</span>
                </a>

                <div class="hidden md:block flex-1 max-w-xl mx-8 search-container">
                    <input type="text" id="searchInput" placeholder="Search for restaurants, cuisines, or dishes..." 
                           class="input-premium pl-12 pr-4 py-3 rounded-full" 
                           oninput="handleSearch(this.value)" onfocus="showSearchResults()" onblur="setTimeout(hideSearchResults, 200)">
                    <svg class="w-5 h-5 absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                    <div id="searchResults" class="search-results"></div>
                </div>

                <div class="flex items-center gap-4">
                    <div class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark Mode"></div>

                    <button onclick="openLocationModal()" class="hidden lg:flex items-center gap-2 px-4 py-2 rounded-full hover:bg-gray-100/50 transition-colors" style="color: var(--text-secondary)">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                        </svg>
                        <span id="navLocation">Select</span>
                    </button>

                    <button onclick="openAuthModal('login')" class="btn-secondary py-2 px-4 hidden sm:block">
                        Sign In
                    </button>

                    <button onclick="toggleCart()" class="relative p-3 rounded-full hover:bg-gray-100/50 transition-colors" style="background: var(--bg-tertiary)">
                        <svg class="w-6 h-6" style="color: var(--text-primary)" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
                        </svg>
                        <span id="cartBadge" class="badge hidden">0</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-gradient pt-32 pb-20 px-6">
        <div class="max-w-7xl mx-auto grid lg:grid-cols-2 gap-16 items-center">
            <div class="animate-fade-up">
                <span class="inline-block px-4 py-2 rounded-full text-sm font-semibold mb-6" style="background: var(--accent-light); color: var(--accent)">
                    Premium Delivery Experience
                </span>
                <h1 class="font-display text-5xl md:text-7xl font-bold leading-tight mb-6">
                    Feasts Delivered <br>
                    <span class="text-gradient">To Your Door</span>
                </h1>
                <p class="text-xl mb-10 max-w-lg" style="color: var(--text-secondary)">
                    Explore curated menus from top-tier local restaurants. Fresh ingredients, master chefs, delivered hot.
                </p>

                <div class="p-2 rounded-3xl shadow-2xl max-w-lg" style="background: var(--bg-secondary); border: 1px solid var(--border)">
                    <div class="flex flex-col sm:flex-row gap-2">
                        <div class="flex-1 relative">
                            <input type="text" id="heroSearch" placeholder="Enter delivery address" class="input-premium border-0 pl-12 rounded-xl" style="background: var(--bg-tertiary)">
                            <svg class="w-5 h-5 absolute left-4 top-1/2 -translate-y-1/2" style="color: var(--text-secondary)" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            </svg>
                        </div>
                        <button onclick="findFood()" class="btn-primary whitespace-nowrap">
                            Find Food
                        </button>
                    </div>
                </div>

                <div class="flex gap-12 mt-12 pt-12" style="border-top: 1px solid var(--border)">
                    <div>
                        <div class="text-4xl font-bold font-display">500+</div>
                        <div style="color: var(--text-secondary)">Restaurants</div>
                    </div>
                    <div>
                        <div class="text-4xl font-bold font-display">15K+</div>
                        <div style="color: var(--text-secondary)">Happy Foodies</div>
                    </div>
                    <div>
                        <div class="text-4xl font-bold font-display">4.9</div>
                        <div style="color: var(--text-secondary)">Avg Rating</div>
                    </div>
                </div>
            </div>

            <!-- Hero Images Grid -->
            <div class="relative animate-fade-up stagger-2 hidden lg:block">
                <div class="grid grid-cols-2 gap-6">
                    <div class="space-y-6 pt-12">
                        <div class="card-premium p-0 animate-float overflow-hidden">
                            <img src="https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?auto=format&fit=crop&w=500&q=80" alt="Pizza" class="h-48 w-full food-img">
                            <div class="p-4">
                                <div class="font-semibold">Artisan Pizza</div>
                                <div class="text-sm" style="color: var(--text-secondary)">From â‚¹299</div>
                            </div>
                        </div>
                        <div class="card-premium p-0 animate-float overflow-hidden" style="animation-delay: 1s">
                            <img src="https://images.unsplash.com/photo-1512621776951-a57141f2eefd?auto=format&fit=crop&w=500&q=80" alt="Salad" class="h-40 w-full food-img">
                            <div class="p-4">
                                <div class="font-semibold">Fresh Salads</div>
                                <div class="text-sm" style="color: var(--text-secondary)">From â‚¹149</div>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-6">
                        <div class="card-premium p-0 animate-float overflow-hidden" style="animation-delay: 0.5s">
                            <img src="https://images.unsplash.com/photo-1568901346375-23c9450c58cd?auto=format&fit=crop&w=500&q=80" alt="Burger" class="h-40 w-full food-img">
                            <div class="p-4">
                                <div class="font-semibold">Gourmet Burgers</div>
                                <div class="text-sm" style="color: var(--text-secondary)">From â‚¹179</div>
                            </div>
                        </div>
                        <div class="card-premium p-0 animate-float overflow-hidden" style="animation-delay: 1.5s">
                            <img src="https://images.unsplash.com/photo-1551024506-0bccd828d307?auto=format&fit=crop&w=500&q=80" alt="Dessert" class="h-48 w-full food-img">
                            <div class="p-4">
                                <div class="font-semibold">Desserts</div>
                                <div class="text-sm" style="color: var(--text-secondary)">From â‚¹99</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Offers Carousel -->
    <section class="py-16 px-6 overflow-hidden">
        <div class="max-w-7xl mx-auto">
            <h2 class="font-display text-3xl font-bold mb-10">Exclusive Offers</h2>
            <div class="flex gap-6 overflow-x-auto pb-4 snap-x" id="offersContainer"></div>
        </div>
    </section>

    <!-- Categories -->
    <section class="py-16 px-6" style="background: var(--bg-tertiary)">
        <div class="max-w-7xl mx-auto">
            <h2 class="font-display text-3xl font-bold mb-10">What's on your mind?</h2>
            <div class="flex gap-4 overflow-x-auto pb-4 snap-x" id="categoriesContainer"></div>
        </div>
    </section>

    <!-- Restaurants -->
    <section class="py-16 px-6" id="restaurantsSection">
        <div class="max-w-7xl mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-4">
                <div>
                    <h2 class="font-display text-3xl font-bold">Popular Restaurants</h2>
                    <p style="color: var(--text-secondary)">Top picks near you</p>
                </div>
                <div class="flex gap-2 flex-wrap" id="filterContainer">
                    <button class="filter-btn active" onclick="setFilter('all', this)">All</button>
                    <button class="filter-btn" onclick="setFilter('rating', this)">Top Rated</button>
                    <button class="filter-btn" onclick="setFilter('fast', this)">Fast Delivery</button>
                </div>
            </div>
            <div class="grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8" id="restaurantGrid"></div>
        </div>
    </section>

    <!-- Menu Section (Hidden Initially) -->
    <section class="py-16 px-6 hidden" id="menuSection">
        <div class="max-w-5xl mx-auto">
            <button onclick="backToRestaurants()" class="flex items-center gap-2 mb-8 font-semibold" style="color: var(--text-secondary)">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
                Back to Restaurants
            </button>
            <div id="restaurantHeader" class="mb-12"></div>
            <div id="menuGrid" class="space-y-6"></div>
        </div>
    </section>

    <!-- Cart Sidebar -->
    <div class="cart-drawer" id="cartDrawer">
        <div class="p-6 border-b flex justify-between items-center" style="border-color: var(--border)">
            <h3 class="font-display text-2xl font-bold">Your Cart</h3>
            <button onclick="toggleCart()" class="p-2 rounded-full hover:bg-gray-100 transition-colors" aria-label="Close cart">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <div class="flex-1 overflow-y-auto p-6" id="cartItems"></div>
        <div class="p-6 border-t" style="border-color: var(--border); background: var(--bg-tertiary)">
            <div class="flex gap-2 mb-6">
                <input type="text" id="couponInput" placeholder="Enter coupon code" class="input-premium text-sm py-2 flex-1">
                <button onclick="applyCoupon()" class="btn-primary py-2 px-6">Apply</button>
            </div>
            <div id="couponStatus" class="text-sm mb-4 font-medium"></div>
            <div class="space-y-3 mb-6">
                <div class="flex justify-between text-sm">
                    <span style="color: var(--text-secondary)">Subtotal</span>
                    <span id="cartSubtotal">â‚¹0</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span style="color: var(--text-secondary)">Delivery</span>
                    <span id="cartDelivery">â‚¹40</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span style="color: var(--text-secondary)">Discount</span>
                    <span id="cartDiscount" style="color: var(--success)">- â‚¹0</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span style="color: var(--text-secondary)">Taxes</span>
                    <span id="cartTaxes">â‚¹0</span>
                </div>
                <div class="border-t pt-4 flex justify-between font-bold text-xl" style="border-color: var(--border)">
                    <span>Total</span>
                    <span id="cartTotal" class="text-gradient">â‚¹0</span>
                </div>
            </div>
            <button onclick="proceedToCheckout()" class="btn-primary w-full py-4 text-lg" id="checkoutBtn">
                Proceed to Pay
            </button>
        </div>
    </div>
    <div class="modal-backdrop" id="cartOverlay" onclick="toggleCart()"></div>

    <!-- Checkout Modal -->
    <div class="modal-backdrop" id="checkoutBackdrop"></div>
    <div class="modal-content" id="checkoutModal">
        <div class="p-8 border-b" style="border-color: var(--border)">
            <div class="flex justify-between items-center">
                <h3 class="font-display text-2xl font-bold">Checkout</h3>
                <button onclick="closeCheckout()" class="p-2 rounded-full hover:bg-gray-100">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="flex items-center gap-2 mt-6">
                <div class="step-indicator active" id="step1">1</div>
                <div class="h-1 flex-1 rounded" style="background: var(--border)"><div class="h-full rounded transition-all duration-500" id="prog1" style="background: var(--accent); width: 0%"></div></div>
                <div class="step-indicator" id="step2">2</div>
                <div class="h-1 flex-1 rounded" style="background: var(--border)"><div class="h-full rounded transition-all duration-500" id="prog2" style="background: var(--accent); width: 0%"></div></div>
                <div class="step-indicator" id="step3">3</div>
            </div>
        </div>
        <div class="p-8">
            <div id="checkoutStep1">
                <h4 class="font-bold text-lg mb-4">Select Delivery Address</h4>
                <div class="space-y-3" id="addressList"></div>
            </div>
            <div id="checkoutStep2" class="hidden">
                <h4 class="font-bold text-lg mb-4">Select Payment Method</h4>
                <div class="space-y-3">
                    <div class="payment-option-block">
                        <label class="flex items-center gap-4 p-4 border rounded-xl cursor-pointer hover:border-orange-400 transition-colors" style="border-color: var(--border)" onclick="selectPayment('upi')">
                            <input type="radio" name="payment" class="w-5 h-5 accent-orange-500">
                            <div class="flex-1">
                                <div class="font-semibold">UPI / Google Pay</div>
                                <div class="text-sm" style="color: var(--text-secondary)">Pay using any UPI app</div>
                            </div>
                            <span class="text-2xl">ðŸ“±</span>
                        </label>
                        <div id="upiInputSection" class="hidden mt-3 p-4 rounded-xl" style="background: var(--bg-tertiary); border: 1px dashed var(--border)">
                            <label class="block text-sm font-medium mb-2">Enter Your UPI ID *</label>
                            <input type="text" id="customerUpiId" placeholder="example@upi" class="input-premium py-2">
                            <p class="text-xs mt-2" style="color: var(--text-secondary)">A payment request will be sent to this ID.</p>
                        </div>
                    </div>
                    <label class="flex items-center gap-4 p-4 border rounded-xl cursor-pointer hover:border-orange-400 transition-colors" style="border-color: var(--border)" onclick="selectPayment('card')">
                        <input type="radio" name="payment" class="w-5 h-5 accent-orange-500">
                        <div class="flex-1">
                            <div class="font-semibold">Credit / Debit Card</div>
                            <div class="text-sm" style="color: var(--text-secondary)">Visa, Mastercard, RuPay</div>
                        </div>
                        <span class="text-2xl">ðŸ’³</span>
                    </label>
                    <label class="flex items-center gap-4 p-4 border rounded-xl cursor-pointer hover:border-orange-400 transition-colors" style="border-color: var(--border)" onclick="selectPayment('cod')">
                        <input type="radio" name="payment" class="w-5 h-5 accent-orange-500">
                        <div class="flex-1">
                            <div class="font-semibold">Cash on Delivery</div>
                            <div class="text-sm" style="color: var(--text-secondary)">Pay when you receive</div>
                        </div>
                        <span class="text-2xl">ðŸ’µ</span>
                    </label>
                </div>
            </div>
            <div id="checkoutStep3" class="hidden">
                <h4 class="font-bold text-lg mb-4">Order Summary</h4>
                <div class="p-6 rounded-xl mb-6" style="background: var(--bg-tertiary)">
                    <div id="orderSummaryItems" class="space-y-2 mb-4"></div>
                    <div class="border-t pt-4 space-y-2" style="border-color: var(--border)">
                        <div class="flex justify-between font-bold text-lg">
                            <span>Total</span>
                            <span id="finalTotal">â‚¹0</span>
                        </div>
                    </div>
                </div>
                <div class="p-4 rounded-xl text-center" style="background: var(--accent-light)">
                    <div class="font-bold text-lg mb-1" style="color: var(--accent)">Estimated Delivery</div>
                    <div class="text-3xl font-bold font-display" id="deliveryEstimate">25-30 min</div>
                </div>
            </div>
        </div>
        <div class="p-8 border-t" style="border-color: var(--border); background: var(--bg-tertiary)">
            <button onclick="nextCheckoutStep()" class="btn-primary w-full py-4 text-lg" id="checkoutNextBtn">
                Continue
            </button>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal-backdrop" id="confirmBackdrop"></div>
    <div class="modal-content text-center p-10" id="confirmModal">
        <div class="w-24 h-24 rounded-full mx-auto mb-6 flex items-center justify-center animate-scale-in" style="background: var(--success)">
            <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
        </div>
        <h3 class="font-display text-3xl font-bold mb-2">Order Confirmed!</h3>
        <p class="mb-6" style="color: var(--text-secondary)">Your food is being prepared with love.</p>
        <div class="p-6 rounded-xl mb-6" style="background: var(--bg-tertiary)">
            <div class="text-sm" style="color: var(--text-secondary)">Order ID</div>
            <div class="text-2xl font-bold" id="orderIdDisplay">#FE12345</div>
        </div>
        <!-- Button Changed Here -->
        <button onclick="goToHome()" class="btn-primary w-full py-4">Back to Home</button>
    </div>
    
    <!-- Auth & Location Modals -->
    <div class="modal-backdrop" id="authBackdrop"></div>
    <div class="modal-content p-10" id="authModal">
        <div class="text-center mb-8">
            <div class="w-16 h-16 rounded-full mx-auto mb-4 flex items-center justify-center" style="background: var(--accent-light)">
                <svg class="w-8 h-8" style="color: var(--accent)" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
            </div>
            <h3 class="font-display text-2xl font-bold" id="authTitle">Sign In</h3>
        </div>
        <form onsubmit="handleAuth(event)" class="space-y-4">
            <input type="email" placeholder="Email Address" class="input-premium" required>
            <input type="password" placeholder="Password" class="input-premium" required>
            <button type="submit" class="btn-primary w-full py-4 mt-6">Sign In</button>
        </form>
        <button onclick="closeAuthModal()" class="w-full text-center mt-4 py-2" style="color: var(--text-secondary)">Cancel</button>
    </div>

    <div class="modal-backdrop" id="locationBackdrop"></div>
    <div class="modal-content p-10" id="locationModal">
        <h3 class="font-display text-2xl font-bold mb-6">Select Location</h3>
        <button onclick="detectLocation()" class="w-full flex items-center gap-4 p-4 border-2 border-dashed rounded-xl mb-6 hover:border-orange-400 transition-colors" style="border-color: var(--border)">
            <svg class="w-6 h-6" style="color: var(--accent)" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
            </svg>
            <div class="text-left">
                <div class="font-semibold">Use Current Location</div>
                <div class="text-sm" style="color: var(--text-secondary)">Enable GPS</div>
            </div>
        </button>
        <div class="space-y-3" id="savedAddressList"></div>
        <button onclick="closeLocationModal()" class="w-full text-center mt-6 py-2" style="color: var(--text-secondary)">Cancel</button>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 px-6 py-3 rounded-full shadow-2xl z-[200] transform translate-y-20 opacity-0 transition-all duration-300" style="background: var(--text-primary); color: var(--bg-primary)">
        <span id="toastMsg">Item added to cart</span>
    </div>

    <script>
        // ===== DATA WITH REAL IMAGES =====
        const MERCHANT_UPI_ID = '9845525565@upi';
        const MERCHANT_NAME = 'FoodieExpress';

        const coupons = {
            'WELCOME50': { type: 'percent', value: 50, max: 100 },
            'FLAT100': { type: 'flat', value: 100 }
        };

        const addresses = [
            { id: 1, type: 'home', title: 'Home', address: '123, Green Park, New Delhi', default: true },
            { id: 2, type: 'work', title: 'Office', address: 'Tech Hub, Sector 62, Noida', default: false }
        ];

        const categories = [
            { id: 1, name: 'Biryani', image: 'https://images.unsplash.com/photo-1563379091339-03b21ab4a4f8?auto=format&fit=crop&w=200&q=80' },
            { id: 2, name: 'Pizza', image: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?auto=format&fit=crop&w=200&q=80' },
            { id: 3, name: 'Burger', image: 'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?auto=format&fit=crop&w=200&q=80' },
            { id: 4, name: 'Chinese', image: 'https://images.unsplash.com/photo-1569718212165-3a8278d5f624?auto=format&fit=crop&w=200&q=80' },
            { id: 5, name: 'North Indian', image: 'https://images.unsplash.com/photo-1585937421612-70a008356fbe?auto=format&fit=crop&w=200&q=80' },
            { id: 6, name: 'South Indian', image: 'https://images.unsplash.com/photo-1630383249896-424e482df921?auto=format&fit=crop&w=200&q=80' },
            { id: 7, name: 'Desserts', image: 'https://images.unsplash.com/photo-1551024506-0bccd828d307?auto=format&fit=crop&w=200&q=80' },
            { id: 8, name: 'Healthy', image: 'https://images.unsplash.com/photo-1512621776951-a57141f2eefd?auto=format&fit=crop&w=200&q=80' }
        ];

        const offers = [
            { title: '50% OFF', subtitle: 'On first order', code: 'WELCOME50', bg: '#FF6B6B' },
            { title: 'FLAT â‚¹100', subtitle: 'Orders above â‚¹400', code: 'FLAT100', bg: '#4D96FF' }
        ];

        const restaurants = [
            {
                id: 1, name: 'Paradise Biryani', cuisine: 'Biryani, North Indian', rating: 4.5, time: '30 min', price: 300, distance: '2.5 km', 
                cover: 'https://images.unsplash.com/photo-1563379091339-03b21ab4a4f8?auto=format&fit=crop&w=800&q=80',
                menu: [
                    { id: 101, name: 'Hyderabadi Chicken Biryani', desc: 'Aromatic rice with tender chicken', price: 320, veg: false, bestseller: true, image: 'https://images.unsplash.com/photo-1563379091339-03b21ab4a4f8?auto=format&fit=crop&w=500&q=80' },
                    { id: 102, name: 'Mutton Dum Biryani', desc: 'Slow cooked mutton', price: 380, veg: false, image: 'https://images.unsplash.com/photo-1544025162-d76694265947?auto=format&fit=crop&w=500&q=80' },
                    { id: 103, name: 'Veg Biryani', desc: 'Mixed vegetables in spiced rice', price: 220, veg: true, image: 'https://images.unsplash.com/photo-1596797038530-2c107229654b?auto=format&fit=crop&w=500&q=80' }
                ]
            },
            {
                id: 2, name: 'La Pinoz Pizza', cuisine: 'Pizza, Italian', rating: 4.3, time: '35 min', price: 400, distance: '3.8 km',
                cover: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?auto=format&fit=crop&w=800&q=80',
                menu: [
                    { id: 201, name: 'Margherita Pizza', desc: 'Classic cheese & tomato', price: 249, veg: true, image: 'https://images.unsplash.com/photo-1574071318508-1cdbab80d002?auto=format&fit=crop&w=500&q=80' },
                    { id: 202, name: 'Pepperoni Feast', desc: 'Loaded with pepperoni', price: 449, veg: false, bestseller: true, image: 'https://images.unsplash.com/photo-1628840042765-356cda07504e?auto=format&fit=crop&w=500&q=80' },
                    { id: 203, name: 'Veggie Supreme', desc: 'Bell peppers, olives, corn', price: 399, veg: true, image: 'https://images.unsplash.com/photo-1511689660979-10d2b1aada49?auto=format&fit=crop&w=500&q=80' }
                ]
            },
            {
                id: 3, name: 'Burger King', cuisine: 'Burgers, American', rating: 4.1, time: '20 min', price: 250, distance: '1.2 km',
                cover: 'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?auto=format&fit=crop&w=800&q=80',
                menu: [
                    { id: 301, name: 'Whopper', desc: 'Signature flame-grilled beef', price: 219, veg: false, bestseller: true, image: 'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?auto=format&fit=crop&w=500&q=80' },
                    { id: 302, name: 'Crispy Veg Burger', desc: 'Crispy vegetable patty', price: 149, veg: true, image: 'https://images.unsplash.com/photo-1550547660-d9450f859349?auto=format&fit=crop&w=500&q=80' },
                    { id: 303, name: 'French Fries', desc: 'Crispy golden fries', price: 99, veg: true, image: 'https://images.unsplash.com/photo-1573080496219-bb080dd4f877?auto=format&fit=crop&w=500&q=80' }
                ]
            },
            {
                id: 4, name: 'Mainland China', cuisine: 'Chinese, Asian', rating: 4.4, time: '40 min', price: 600, distance: '4.5 km',
                cover: 'https://images.unsplash.com/photo-1569718212165-3a8278d5f624?auto=format&fit=crop&w=800&q=80',
                menu: [
                    { id: 401, name: 'Chicken Manchurian', desc: 'Deep fried chicken in tangy sauce', price: 329, veg: false, bestseller: true, image: 'https://images.unsplash.com/photo-1525755662778-989d0524087e?auto=format&fit=crop&w=500&q=80' },
                    { id: 402, name: 'Hakka Noodles', desc: 'Stir fried noodles', price: 229, veg: true, image: 'https://images.unsplash.com/photo-1569718212165-3a8278d5f624?auto=format&fit=crop&w=500&q=80' },
                    { id: 403, name: 'Spring Rolls', desc: 'Crispy rolls with veggie filling', price: 169, veg: true, image: 'https://images.unsplash.com/photo-1544025162-d76694265947?auto=format&fit=crop&w=500&q=80' }
                ]
            },
            {
                id: 5, name: 'Haldiram\'s', cuisine: 'North Indian, Chaat', rating: 4.2, time: '25 min', price: 300, distance: '2.0 km',
                cover: 'https://images.unsplash.com/photo-1585937421612-70a008356fbe?auto=format&fit=crop&w=800&q=80',
                menu: [
                    { id: 501, name: 'Chole Bhature', desc: 'Spiced chickpeas with fried bread', price: 169, veg: true, bestseller: true, image: 'https://images.unsplash.com/photo-1626132647523-66d36e13f83f?auto=format&fit=crop&w=500&q=80' },
                    { id: 502, name: 'Pav Bhaji', desc: 'Mashed vegetable curry', price: 149, veg: true, image: 'https://images.unsplash.com/photo-1606491956689-2ea866880c84?auto=format&fit=crop&w=500&q=80' }
                ]
            },
            {
                id: 6, name: 'Saravana Bhavan', cuisine: 'South Indian', rating: 4.6, time: '25 min', price: 200, distance: '1.8 km',
                cover: 'https://images.unsplash.com/photo-1630383249896-424e482df921?auto=format&fit=crop&w=800&q=80',
                menu: [
                    { id: 601, name: 'Masala Dosa', desc: 'Crispy crepe with potato filling', price: 129, veg: true, bestseller: true, image: 'https://images.unsplash.com/photo-1630383249896-424e482df921?auto=format&fit=crop&w=500&q=80' },
                    { id: 602, name: 'Idli Sambar', desc: 'Steamed rice cakes', price: 89, veg: true, image: 'https://images.unsplash.com/photo-1589301760014-d929f3979dbc?auto=format&fit=crop&w=500&q=80' }
                ]
            },
            {
                id: 7, name: 'Baskin Robbins', cuisine: 'Desserts, Ice Cream', rating: 4.3, time: '15 min', price: 150, distance: '1.0 km',
                cover: 'https://images.unsplash.com/photo-1551024506-0bccd828d307?auto=format&fit=crop&w=800&q=80',
                menu: [
                    { id: 701, name: 'Chocolate Sundae', desc: 'Rich chocolate ice cream', price: 179, veg: true, bestseller: true, image: 'https://images.unsplash.com/photo-1563805042-7684c019e1cb?auto=format&fit=crop&w=500&q=80' },
                    { id: 702, name: 'Butterscotch Cone', desc: 'Creamy butterscotch', price: 99, veg: true, image: 'https://images.unsplash.com/photo-1551024506-0bccd828d307?auto=format&fit=crop&w=500&q=80' }
                ]
            },
            {
                id: 8, name: 'Subway', cuisine: 'Healthy, Salads', rating: 4.0, time: '20 min', price: 200, distance: '1.5 km',
                cover: 'https://images.unsplash.com/photo-1512621776951-a57141f2eefd?auto=format&fit=crop&w=800&q=80',
                menu: [
                    { id: 801, name: 'Turkey Breast Sub', desc: 'Lean turkey with veggies', price: 219, veg: false, bestseller: true, image: 'https://images.unsplash.com/photo-1509722747041-616f39b57569?auto=format&fit=crop&w=500&q=80' },
                    { id: 802, name: 'Veggie Delight', desc: 'Fresh veggies', price: 159, veg: true, image: 'https://images.unsplash.com/photo-1512621776951-a57141f2eefd?auto=format&fit=crop&w=500&q=80' }
                ]
            }
        ];

        // ===== STATE =====
        let cart = [];
        let currentRestaurant = null;
        let currentStep = 1;
        let selectedAddressId = null;
        let selectedPaymentMethod = null;
        let appliedCoupon = null;
        let isDarkTheme = false;
        let currentOrderId = '';

        // ===== INIT =====
        document.addEventListener('DOMContentLoaded', () => {
            renderCategories();
            renderOffers();
            renderRestaurants();
            renderAddresses();
            loadTheme();
            loadCart();
        });

        // ===== THEME & HELPERS =====
        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            document.documentElement.setAttribute('data-theme', isDarkTheme ? 'dark' : 'light');
            localStorage.setItem('theme', isDarkTheme ? 'dark' : 'light');
        }
        function loadTheme() {
            const saved = localStorage.getItem('theme');
            if (saved === 'dark') {
                isDarkTheme = true;
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        }
        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMsg').textContent = msg;
            toast.classList.remove('translate-y-20', 'opacity-0');
            toast.classList.add('translate-y-0', 'opacity-100');
            setTimeout(() => { toast.classList.add('translate-y-20', 'opacity-0'); toast.classList.remove('translate-y-0', 'opacity-100'); }, 3000);
        }

        // ===== RENDER =====
        function renderCategories() {
            const container = document.getElementById('categoriesContainer');
            container.innerHTML = categories.map(c => `
                <div onclick="searchByCategory('${c.name}')" class="flex-shrink-0 flex flex-col items-center gap-3 p-4 w-28 rounded-2xl transition-all hover:scale-105 cursor-pointer snap-center" style="background: var(--bg-secondary)">
                    <img src="${c.image}" alt="${c.name}" class="w-20 h-20 rounded-xl object-cover shadow-sm">
                    <span class="font-semibold text-sm text-center">${c.name}</span>
                </div>
            `).join('');
        }

        function renderOffers() {
            const container = document.getElementById('offersContainer');
            container.innerHTML = offers.map(o => `
                <div class="flex-shrink-0 w-80 p-8 rounded-3xl text-white relative overflow-hidden snap-center" style="background: ${o.bg}">
                    <div class="text-4xl font-bold font-display mb-2">${o.title}</div>
                    <div class="opacity-80 mb-4">${o.subtitle}</div>
                    <code class="bg-white/20 px-4 py-1 rounded-full text-sm">${o.code}</code>
                </div>
            `).join('');
        }

        function renderRestaurants(filtered = restaurants) {
            const container = document.getElementById('restaurantGrid');
            container.innerHTML = filtered.map((r, i) => `
                <div class="card-premium cursor-pointer animate-fade-up" style="animation-delay: ${i * 0.05}s" onclick="openRestaurant(${r.id})">
                    <div class="h-48 relative img-container">
                        <img src="${r.cover}" alt="${r.name}" class="food-img">
                        <div class="absolute top-4 right-4 px-3 py-1 rounded-full text-sm font-bold" style="background: var(--success); color: white">
                            ${r.rating} â˜…
                        </div>
                    </div>
                    <div class="p-6">
                        <h3 class="font-bold text-lg mb-1">${r.name}</h3>
                        <p class="text-sm mb-3 truncate" style="color: var(--text-secondary)">${r.cuisine}</p>
                        <div class="flex items-center justify-between text-sm" style="color: var(--text-secondary)">
                            <span>${r.time}</span>
                            <span>â‚¹${r.price} for two</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderAddresses() {
            const savedList = document.getElementById('savedAddressList');
            const checkoutList = document.getElementById('addressList');
            const html = addresses.map(a => `
                <label class="flex items-start gap-4 p-4 border rounded-xl cursor-pointer hover:border-orange-400 transition-colors ${selectedAddressId === a.id ? 'border-orange-500' : ''}" style="border-color: ${selectedAddressId === a.id ? 'var(--accent)' : 'var(--border)'}" onclick="selectAddress(${a.id})">
                    <input type="radio" name="address" class="mt-1 accent-orange-500" ${selectedAddressId === a.id ? 'checked' : ''}>
                    <div>
                        <div class="font-semibold">${a.title}</div>
                        <div class="text-sm" style="color: var(--text-secondary)">${a.address}</div>
                    </div>
                </label>
            `).join('');
            if(savedList) savedList.innerHTML = html;
            if(checkoutList) checkoutList.innerHTML = html;
        }

        // ===== RESTAURANT & MENU =====
        function openRestaurant(id) {
            currentRestaurant = restaurants.find(r => r.id === id);
            if(!currentRestaurant) return;
            document.getElementById('restaurantsSection').classList.add('hidden');
            document.getElementById('menuSection').classList.remove('hidden');
            
            const header = document.getElementById('restaurantHeader');
            header.innerHTML = `
                <div class="flex flex-col md:flex-row gap-8 items-start">
                    <div class="w-32 h-32 rounded-3xl overflow-hidden img-container shadow-lg">
                        <img src="${currentRestaurant.cover}" class="food-img">
                    </div>
                    <div class="flex-1">
                        <h2 class="font-display text-4xl font-bold mb-2">${currentRestaurant.name}</h2>
                        <p class="mb-4" style="color: var(--text-secondary)">${currentRestaurant.cuisine}</p>
                        <div class="flex flex-wrap gap-6 text-sm">
                            <div class="flex items-center gap-2">
                                <span class="px-2 py-1 rounded font-bold text-white" style="background: var(--success)">${currentRestaurant.rating} â˜…</span>
                                <span style="color: var(--text-secondary)">Rating</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="font-bold" style="color: var(--accent)">${currentRestaurant.time}</span>
                                <span style="color: var(--text-secondary)">Delivery Time</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            renderMenu();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function renderMenu() {
            const container = document.getElementById('menuGrid');
            container.innerHTML = currentRestaurant.menu.map(item => `
                <div class="card-premium p-4 flex gap-6 items-center">
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="w-4 h-4 rounded-sm ${item.veg ? 'bg-green-500' : 'bg-red-500'} flex items-center justify-center">
                                <span class="w-2 h-2 bg-white rounded-full"></span>
                            </span>
                            <span class="font-bold">${item.name}</span>
                            ${item.bestseller ? '<span class="text-xs px-2 py-0.5 rounded" style="background: var(--accent-light); color: var(--accent)">Bestseller</span>' : ''}
                        </div>
                        <p class="text-sm mb-2" style="color: var(--text-secondary)">${item.desc}</p>
                        <div class="font-bold text-lg">â‚¹${item.price}</div>
                    </div>
                    <div class="flex-shrink-0 text-center">
                        <div class="w-28 h-28 rounded-2xl mb-2 overflow-hidden img-container" style="background: var(--bg-tertiary)">
                            <img src="${item.image}" alt="${item.name}" class="food-img">
                        </div>
                        <button onclick="addToCart(${item.id})" class="btn-primary py-2 px-6 text-sm">ADD</button>
                    </div>
                </div>
            `).join('');
        }

        function backToRestaurants() {
            document.getElementById('menuSection').classList.add('hidden');
            document.getElementById('restaurantsSection').classList.remove('hidden');
            currentRestaurant = null;
        }

        // ===== CART =====
        function addToCart(itemId) {
            const item = currentRestaurant.menu.find(i => i.id === itemId);
            if(!item) return;
            const existing = cart.find(c => c.id === itemId);
            if(existing) existing.qty++;
            else cart.push({ ...item, qty: 1, restaurantId: currentRestaurant.id, restaurantName: currentRestaurant.name });
            updateCart();
            showToast(`${item.name} added to cart`);
        }

        function updateQty(id, delta) {
            const item = cart.find(c => c.id === id);
            if(item) {
                item.qty += delta;
                if(item.qty <= 0) cart = cart.filter(c => c.id !== id);
            }
            updateCart();
        }

        function updateCart() {
            localStorage.setItem('foodieCart', JSON.stringify(cart));
            const totalItems = cart.reduce((s, i) => s + i.qty, 0);
            const badge = document.getElementById('cartBadge');
            badge.textContent = totalItems;
            badge.classList.toggle('hidden', totalItems === 0);

            const container = document.getElementById('cartItems');
            if(cart.length === 0) {
                container.innerHTML = `<div class="text-center py-16"><div class="text-6xl mb-4">ðŸ›’</div><h4 class="font-bold text-xl mb-2">Your cart is empty</h4><p style="color: var(--text-secondary)">Add items from a restaurant</p></div>`;
            } else {
                container.innerHTML = cart.map(item => `
                    <div class="flex gap-4 py-4 border-b" style="border-color: var(--border)">
                        <div class="w-16 h-16 rounded-xl overflow-hidden flex-shrink-0">
                            <img src="${item.image}" class="w-full h-full object-cover">
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <span class="w-3 h-3 rounded-sm ${item.veg ? 'bg-green-500' : 'bg-red-500'} flex items-center justify-center"><span class="w-1.5 h-1.5 bg-white rounded-full"></span></span>
                                <span class="font-semibold text-sm">${item.name}</span>
                            </div>
                            <div class="font-bold">â‚¹${item.price}</div>
                            <div class="flex items-center gap-3 mt-2">
                                <button onclick="updateQty(${item.id}, -1)" class="w-8 h-8 rounded-full border flex items-center justify-center hover:border-orange-400" style="border-color: var(--border)">-</button>
                                <span class="font-bold">${item.qty}</span>
                                <button onclick="updateQty(${item.id}, 1)" class="w-8 h-8 rounded-full border flex items-center justify-center hover:border-orange-400" style="border-color: var(--border)">+</button>
                            </div>
                        </div>
                        <div class="font-bold">â‚¹${item.price * item.qty}</div>
                    </div>
                `).join('');
            }
            calculateTotals();
        }

        function calculateTotals() {
            const subtotal = cart.reduce((s, i) => s + (i.price * i.qty), 0);
            let delivery = subtotal > 0 ? 40 : 0;
            let discount = 0;
            if(appliedCoupon && coupons[appliedCoupon]) {
                const c = coupons[appliedCoupon];
                if(c.type === 'percent') discount = Math.min(subtotal * c.value / 100, c.max);
                if(c.type === 'flat') discount = c.value;
            }
            const taxes = Math.round((subtotal - discount) * 0.05);
            const total = subtotal + delivery - discount + taxes;
            document.getElementById('cartSubtotal').textContent = `â‚¹${subtotal}`;
            document.getElementById('cartDelivery').textContent = delivery === 0 ? 'FREE' : `â‚¹${delivery}`;
            document.getElementById('cartDiscount').textContent = `- â‚¹${discount}`;
            document.getElementById('cartTaxes').textContent = `â‚¹${taxes}`;
            document.getElementById('cartTotal').textContent = `â‚¹${total}`;
            document.getElementById('finalTotal').textContent = `â‚¹${total}`;
        }

        function loadCart() { const saved = localStorage.getItem('foodieCart'); if(saved) cart = JSON.parse(saved); updateCart(); }
        function toggleCart() { document.getElementById('cartDrawer').classList.toggle('open'); document.getElementById('cartOverlay').classList.toggle('active'); }
        function applyCoupon() {
            const code = document.getElementById('couponInput').value.toUpperCase().trim();
            const status = document.getElementById('couponStatus');
            if(coupons[code]) {
                appliedCoupon = code;
                status.innerHTML = `<span style="color: var(--success)">âœ“ Coupon applied!</span>`;
                showToast('Coupon applied!');
                calculateTotals();
            } else { status.innerHTML = `<span style="color: var(--accent)">Invalid code</span>`; }
        }

        // ===== CHECKOUT & PAYMENT =====
        function proceedToCheckout() {
            if(cart.length === 0) { showToast('Your cart is empty'); return; }
            toggleCart(); currentStep = 1; updateCheckoutStep(); openModal('checkout');
        }

        function nextCheckoutStep() {
            if(currentStep === 1 && !selectedAddressId) { showToast('Select address'); return; }
            if(currentStep === 2 && !selectedPaymentMethod) { showToast('Select payment method'); return; }
            if(currentStep === 2 && selectedPaymentMethod === 'upi') {
                const upiVal = document.getElementById('customerUpiId').value;
                if (!upiVal || !upiVal.includes('@')) { showToast('Enter valid UPI ID'); return; }
            }
            if(currentStep === 3) { processOrder(); return; }
            currentStep++; updateCheckoutStep();
        }

        function updateCheckoutStep() {
            document.getElementById('checkoutStep1').classList.add('hidden');
            document.getElementById('checkoutStep2').classList.add('hidden');
            document.getElementById('checkoutStep3').classList.add('hidden');
            document.getElementById(`checkoutStep${currentStep}`).classList.remove('hidden');
            for(let i=1; i<=3; i++) {
                const el = document.getElementById(`step${i}`);
                el.classList.remove('active', 'done');
                if(i < currentStep) el.classList.add('done');
                if(i === currentStep) el.classList.add('active');
            }
            document.getElementById('prog1').style.width = currentStep > 1 ? '100%' : '0%';
            document.getElementById('prog2').style.width = currentStep > 2 ? '100%' : '0%';
            document.getElementById('checkoutNextBtn').textContent = currentStep === 3 ? 'Place Order' : 'Continue';
            if(currentStep === 3) {
                document.getElementById('orderSummaryItems').innerHTML = cart.map(i => `<div class="flex justify-between text-sm"><span>${i.name} x ${i.qty}</span><span>â‚¹${i.price * i.qty}</span></div>`).join('');
                const time = Math.floor(Math.random() * 20) + 25;
                document.getElementById('deliveryEstimate').textContent = `${time}-${time+10} min`;
            }
        }

        function selectAddress(id) { selectedAddressId = id; renderAddresses(); }
        function selectPayment(method) {
            selectedPaymentMethod = method;
            document.getElementById('upiInputSection').classList.toggle('hidden', method !== 'upi');
        }

        function processOrder() {
            const btn = document.getElementById('checkoutNextBtn');
            btn.innerHTML = `<svg class="animate-spin h-5 w-5 mx-auto" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`;
            currentOrderId = 'FE' + Math.random().toString(36).substr(2, 9).toUpperCase();
            
            // Calculate Total for payment
            const subtotal = cart.reduce((s, i) => s + (i.price * i.qty), 0);
            const total = subtotal + 40; // Simplified for demo

            setTimeout(() => {
                if (selectedPaymentMethod === 'upi') {
                    const upiLink = `upi://pay?pa=${MERCHANT_UPI_ID}&pn=${encodeURIComponent(MERCHANT_NAME)}&am=${total}&cu=INR&tn=${encodeURIComponent('Order ' + currentOrderId)}`;
                    window.location.href = upiLink;
                }
                closeCheckout();
                document.getElementById('orderIdDisplay').textContent = '#' + currentOrderId;
                openModal('confirm');
                cart = []; updateCart();
                btn.textContent = 'Place Order';
            }, 1500);
        }

        // ===== SEARCH & FILTER =====
        function handleSearch(query) {
            const resultsDiv = document.getElementById('searchResults');
            if(query.length < 2) { resultsDiv.classList.remove('active'); return; }
            const q = query.toLowerCase();
            const matched = restaurants.filter(r => r.name.toLowerCase().includes(q) || r.cuisine.toLowerCase().includes(q));
            if(matched.length === 0) { resultsDiv.innerHTML = `<div class="p-4 text-center">No results</div>`; }
            else {
                resultsDiv.innerHTML = matched.map(r => `
                    <div class="p-3 hover:bg-gray-50 cursor-pointer flex items-center gap-3" onmousedown="openRestaurant(${r.id})">
                        <img src="${r.cover}" class="w-10 h-10 rounded-lg object-cover">
                        <div>
                            <div class="font-semibold">${r.name}</div>
                            <div class="text-sm" style="color:var(--text-secondary)">${r.cuisine}</div>
                        </div>
                    </div>
                `).join('');
            }
            resultsDiv.classList.add('active');
        }
        function showSearchResults() { if(document.getElementById('searchInput').value.length >= 2) document.getElementById('searchResults').classList.add('active'); }
        function hideSearchResults() { document.getElementById('searchResults').classList.remove('active'); }
        function searchByCategory(name) {
            const filtered = restaurants.filter(r => r.cuisine.toLowerCase().includes(name.toLowerCase()));
            renderRestaurants(filtered);
            document.getElementById('restaurantsSection').scrollIntoView({ behavior: 'smooth' });
        }
        function setFilter(type, btn) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            let filtered = restaurants;
            if(type === 'rating') filtered = restaurants.filter(r => r.rating >= 4.3);
            if(type === 'fast') filtered = restaurants.filter(r => parseInt(r.time) <= 25);
            renderRestaurants(filtered);
        }

        // ===== MODALS =====
        function openModal(type) {
            if(type === 'checkout') { document.getElementById('checkoutBackdrop').classList.add('active'); document.getElementById('checkoutModal').classList.add('active'); }
            else if(type === 'confirm') { document.getElementById('confirmBackdrop').classList.add('active'); document.getElementById('confirmModal').classList.add('active'); }
            else if(type === 'auth') { document.getElementById('authBackdrop').classList.add('active'); document.getElementById('authModal').classList.add('active'); }
            else if(type === 'location') { document.getElementById('locationBackdrop').classList.add('active'); document.getElementById('locationModal').classList.add('active'); }
        }
        function closeCheckout() { document.getElementById('checkoutBackdrop').classList.remove('active'); document.getElementById('checkoutModal').classList.remove('active'); }
        
        // Function to close all modals and go back to home
        function goToHome() {
            document.querySelectorAll('.modal-backdrop').forEach(m => m.classList.remove('active')); 
            document.querySelectorAll('.modal-content').forEach(m => m.classList.remove('active')); 
            backToRestaurants();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function closeAllModals() { 
            document.querySelectorAll('.modal-backdrop').forEach(m => m.classList.remove('active')); 
            document.querySelectorAll('.modal-content').forEach(m => m.classList.remove('active')); 
            backToRestaurants(); 
        }
        function openAuthModal() { openModal('auth'); }
        function closeAuthModal() { document.getElementById('authBackdrop').classList.remove('active'); document.getElementById('authModal').classList.remove('active'); }
        function openLocationModal() { renderAddresses(); openModal('location'); }
        function closeLocationModal() { document.getElementById('locationBackdrop').classList.remove('active'); document.getElementById('locationModal').classList.remove('active'); }
        function detectLocation() { showToast('Location detected'); document.getElementById('navLocation').textContent = 'Current Location'; closeLocationModal(); }
        function findFood() { if(!document.getElementById('heroSearch').value) openLocationModal(); else document.getElementById('restaurantsSection').scrollIntoView({ behavior: 'smooth' }); }
        function handleAuth(e) { e.preventDefault(); showToast('Signed in!'); closeAuthModal(); }
    </script>
</body>
</html>